---
import "../../styles/global.css";
import { getCollection, type CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post: CollectionEntry<"blog">) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const post = (Astro.props as unknown as { post: CollectionEntry<"blog"> }).post;
const { Content } = await post.render();
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" href="/favicon.ico" />
    <title>{post.data.title} | Blog</title>
    <meta name="description" content={post.data.description} />
    <script>
      const theme = localStorage.getItem("theme") || "system";
      const prefersDark = window.matchMedia(
        "(prefers-color-scheme: dark)",
      ).matches;
      const shouldUseDark =
        theme === "dark" || (theme === "system" && prefersDark);
      if (shouldUseDark) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
      document.documentElement.dataset.theme = theme;
    </script>
  </head>
  <body>
    <main class="min-h-screen">
      <article
        class="mx-auto w-full max-w-3xl px-4 sm:px-6 lg:px-8 pt-6 sm:pt-8 pb-12 sm:pb-16 space-y-6"
      >
        <a
          href="/blog"
          class="text-sm sm:text-base text-muted-foreground hover:text-foreground transition-colors"
        >
          ‚Üê Volver al blog
        </a>
        <header class="space-y-3">
          <h1 class="text-3xl sm:text-4xl font-bold">{post.data.title}</h1>
          <p class="text-sm sm:text-base text-muted-foreground">
            {
              post.data.date.toLocaleDateString("es-ES", {
                year: "numeric",
                month: "long",
                day: "numeric",
              })
            }
          </p>
          {
            post.data.tags?.length ? (
              <div class="flex flex-wrap gap-2">
                {post.data.tags.map((tag: string) => (
                  <span class="rounded-full border border-border px-3 py-1 text-xs sm:text-sm bg-background/70">
                    {tag}
                  </span>
                ))}
              </div>
            ) : null
          }
        </header>

        <div class="space-y-4 text-base sm:text-lg leading-relaxed">
          <Content />
        </div>
      </article>
    </main>
  </body>
</html>
